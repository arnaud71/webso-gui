<div ng-controller="headerCtrl">
    <div ng-include src="template.url"></div>
</div>

<ol class="breadcrumb text-center">
    <li><a href="#/home">{{ '_SERVICE_NAME_' | i18n }}</a></li>
    <li><a href="#">{{ '_ORGANIZE_BAR_ITEM_' | i18n }}</a></li>
    <li class="active">{{ '_ORGANIZE_BAR_WFOLDER_' | i18n }}</li>
</ol>


<div id="watch-folder" ng-controller="wfolderCtrl">
    <h2>{{ '_WFOLDER_H2_' | i18n }}</h2>
	<link rel="stylesheet" href="styles/treeview.css">

    <div class="row">
        <div class="col-lg-4">
            <h3>{{ '_TREE_STRUCTURE_' | i18n }}
                <a href="" class="btn btn-sm btn-default pull-right" ng-click="collapseAll()">{{ '_COLLAPSE_ALL_' | i18n }}</a>
                <a href="" class="btn btn-sm btn-default pull-right" ng-click="expandAll()">{{ '_EXPAND_ALL_' | i18n }}</a>
                    <!-- <a href="" class="btn btn-default btn-warning pull-right" ng-click="moveLastToTheBegginig()">Move Last To The Beginning</a> -->

            </h3>

            <!-- Nested node template -->
            <script type="text/ng-template" id="nodes_renderer.html">
                <div ui-tree-handle class="tree-node tree-node-content">    

                    <a class="btn btn-default btn-xs" ng-if="node.nodes && node.nodes.length > 0" data-nodrag ng-click="toggle(this)"><span class="glyphicon" ng-class="{'glyphicon-chevron-right': collapsed, 'glyphicon-chevron-down': !collapsed}"></span></a>
                    <a data-nodrag href="#" ng-show="model.edit"  editable-text="node.title">{{ node.title || "empty" }}</a>
                    <!-- <span data-nodrag ng-show="!model.edit">{{ node.title || "empty" }}</span> -->
                    <a data-nodrag ng-show="!model.edit" ng-click="folderList(this)">{{ node.title || "empty" }}</a>


                    <a ng-show="((node.id>1) && (model.edit))" class="pull-right btn btn-default btn-xs" data-nodrag ng-click="remove(this)"><span class="glyphicon glyphicon-remove"></span></a>
                    <a ng-show="model.edit" class="pull-right btn btn-default btn-xs" data-nodrag ng-click="newSubItem(this)" style="margin-right: 8px;"><span class="glyphicon glyphicon-plus"></span></a>

                </div>
                <ol ui-tree-nodes="" ng-model="node.nodes" ng-class="{hidden: collapsed}">
                    <li ng-repeat="node in node.nodes" ui-tree-node ng-include="'nodes_renderer.html'">
                    </li>
                </ol>
            </script>

            <div ui-tree id="tree-root" data-drag-enabled="{{model.edit}}">

                <ol ui-tree-nodes="" ng-model="model.data" data-max-depth="5" data-drag-delay="500">
                    <li ng-repeat="node in model.data" ui-tree-node ng-include="'nodes_renderer.html'"></li>
                </ol>
            </div>
            <a ng-show="!model.edit" href="" class="btn btn-default pull-left" ng-click="editTree()">{{ '_EDIT_' | i18n }}</a>
            <a ng-show="model.edit" href="" class="btn btn-default pull-left" ng-click="saveTree()">{{ '_SAVE_' | i18n }}</a>
            <a ng-show="model.edit" href="" class="btn btn-default pull-left" ng-click="cancelTree()">{{ '_CANCEL_' | i18n }}</a>
        </div>

        <div class="col-lg-8">
            <h3>{{ '_FOLDER_INFORMATION_' | i18n }}</h3>
            <!-- <div class="info">
                {{folder}}
            </div> -->
            <div class="alert alert-danger" ng-show="isError">
                <strong>{{ '_ERROR_' | i18n }} :&nbsp;</strong><span>{{errorMessage}}</span>
            </div>
            <div class="table-responsive">
                <table ng-if="folder && !viewDocs" class="table table-striped table-hover"> 
                    <thead>
                    <tr>
                        <th></th>
                        <th>
                            {{ '_TITLE_' | i18n }}
                        </th>
                        <th>
                            {{ '_SOURCES_' | i18n }}
                        </th>
                        <th>
                            {{ '_QUERY_' | i18n }}
                        </th>
                        <th>
                            {{ '_TAGS_' | i18n }}
                        </th>
                        <th>
                            {{ '_FOLDER_' | i18n }}
                        </th>
                        <th>
                            {{ '_FREQUENCY_CHECK_' | i18n }}
                        </th>
                        <th>
                            {{ '_NOTIFICATION_' | i18n }}
                        </th>
                    </tr>
                    </thead>
                    <tr ng-repeat="fold in folder">
                        <td><a class="btn" ng-click="viewMore(fold.id)"><span class="glyphicon glyphicon-chevron-right"></span></a></td>
                        <td>{{fold.title_t}}</td>
                        <td><span ng-repeat="source in fold.source_name_ss"><a>{{source}}</a><br></span></td>
                        <td>{{fold.query_s}}</td>
                        <td><span ng-repeat="tag in fold.tags_ss"><a>{{tag}}</a><br></span></td>
                        <td>{{fold.folder_s}}</td>
                        <td>{{fold.refresh_s}}</td>
                        <td>{{fold.notification_s}}</td>
                    <!-- <tr ng-repeat="fold in folder">
                        <td>
                            <div id="titleFound">
                                <a href="{{fold.url_s}}" target="_blank">{{fold.title_t}}</a>
                            </div>
                            <div id="contentFound">
                                <span>{{ '_SEARCH_' | i18n }} : {{ fold.query_s }} | {{ fold.notification_s }}</span><br>
                                <span>{{ '_WATCH_DATE_' | i18n }} : {{ fold.creation_dt | date:'dd-MM-yyyy HH:mm' }}</span><br>
                                <span>{{ '_UPDATED_ON_' | i18n }} : {{ fold.updating_dt | date:'dd-MM-yyyy HH:mm' }}</span>
                            </div>
                            <div id="actionList">
                                <button type="button" class="btn btn-xs" ng-click="pathValidate('{{doc.url_s}}')" tooltip="Valider le document"> <span class="glyphicon glyphicon-saved"></span></button>
                            </div>
                        </td> -->
                    </tr>
                </table>
                <a ng-if="viewDocs" ng-click="resetViewMore()">Reset</a>
                <table ng-if="viewDocs" class="table table-striped table-hover">
                    <thead>
                    <tr>
                        <th></th>
                        <th>
                            {{ '_TITLE_' | i18n }}
                        </th>
                        <th>
                            {{ '_SOURCES_' | i18n }}
                        </th>
                        <th>
                            {{ '_QUERY_' | i18n }}
                        </th>
                        <th>
                            {{ '_TAGS_' | i18n }}
                        </th>
                        <th>
                            {{ '_FOLDER_' | i18n }}
                        </th>
                        <th>
                            {{ '_FREQUENCY_CHECK_' | i18n }}
                        </th>
                        <th>
                            {{ '_NOTIFICATION_' | i18n }}
                        </th>
                    </tr>
                    </thead>
                    <tr ng-repeat="fold in watch">
                        <td><a class="btn" ng-click="viewMore(fold.id)"><span class="glyphicon glyphicon-chevron-down"></span></a></td>
                        <td>{{fold.title_t}}</td>
                        <td><span ng-repeat="source in fold.source_name_ss"><a>{{source}}</a><br></span></td>
                        <td>{{fold.query_s}}</td>
                        <td><span ng-repeat="tag in fold.tags_ss"><a>{{tag}}</a><br></span></td>
                        <td>{{fold.folder_s}}</td>
                        <td>{{fold.refresh_s}}</td>
                        <td>{{fold.notification_s}}</td>
                    </tr>
                </table>
                <table ng-if="viewDocs" class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th></th>
                            <th>
                                {{ '_TITLE_' | i18n }}
                            </th>
                            <th>
                                {{ '_CONTENT_' | i18n }}
                            </th>
                            <th>
                                {{ '_DATE_' | i18n }}
                            </th>
                            <th>
                                {{ '_READ_' | i18n }}
                            </th>
                            <!-- <th>
                                {{ '_VALIDATE_' | i18n }}
                            </th> -->
                            <th>
                                {{ '_CRUD_' | i18n }}
                            </th>
                        </tr>
                    </thead>
                    <tr ng-repeat="fold in watch[0].documents">
                        <!-- <td><a class="btn" ng-click="viewMore(fold.id)"><span class="glyphicon glyphicon-chevron-right"></span></a></td> -->
                        <td></td>
                        <td>{{fold.title_t}}</td>
                        <td>{{fold.content_t | limitTo:100}}...</td>
                        <td>{{fold.date_dt | date:'dd-MM-yyyy HH:mm'}}</td>
                        <td>{{fold.read_b}}</td>
                        <!-- <td>{{fold.validated_b}}</td> -->
                        <td>
                            <button ng-show="fold.validated_b == false" type="button" class="btn btn-xs" ng-click="validateDoc(fold,true,'solr')" tooltip="{{ '_VALIDATE_DOC_' | i18n }}"> <span class="glyphicon glyphicon-saved"></span></button>
                            <button ng-show="fold.validated_b == true" type="button" class="btn btn-xs" ng-click="validateDoc(fold,false,'solr')" tooltip="{{ '_UNVALDIATE_DOC_' | i18n }}"> <span class="glyphicon glyphicon-saved text-primary"></span></button>
                            <button type="button" class="btn btn-xs" ng-click="shareDoc(fold,'solr')" tooltip="{{ '_SHARE_DOCUMENT_' | i18n }}"> <span class="glyphicon glyphicon-send"></span></button>
                        </td>
                    </tr>
                </table>
            </div>
            <!-- <pre class="code" ng-repeat="fold in folder">{{ fold.title_t }}</pre> -->



            <!-- <h3>Data binding</h3>
            <div class="info">
                {{info}}
            </div>
            <pre class="code">{{ model.data | json }}</pre> -->
        </div>
    </div>
</div>